///////////////////////////////////////////////////////////
//  Birds.as
//  Macromedia ActionScript Implementation of the Class Birds
//  Generated by Enterprise Architect
//  Created on:      13-十一月-2011 16:38:32
//  Original author: LuXianli
///////////////////////////////////////////////////////////

package com.raytoon.cannonfodder.puremvc.view.ui.birdLayer
{
	import com.raytoon.cannonfodder.tools.BaseSprite;
	import flash.display.MovieClip;
	import flash.display.Sprite;
	import flash.events.Event;
	import flash.system.ApplicationDomain;
	import flash.utils.getTimer;
	/**
	 * @author LuXianli
	 * @version 1.0
	 * @created 13-十一月-2011 16:38:32
	 */
	public class Birds extends BaseSprite
	{
		private var _life:int = -50;
		private var _right:int = 50;
		private var _top:int = -50;
		private var _bottom:int = 50;
		
		private var _birdArr:Array;
		private var _birdSum:int;
		
		private var _vXarr:Array;
		private var _vYarr:Array;
		
		private var _preTimeArr:Array;//上次变换速度时间
		private var _changeSpeedArr:Array;// 间隔多少毫秒变换所有速度
		
		
		public function Birds(){
			super();
			_birdArr = new Array();
			_vXarr = new Array();
			_vYarr = new Array();
			_preTimeArr = new Array();
			_changeSpeedArr = new Array();
			
			_birdSum = Math.random() * 6 + 5;
			for (var i:int = 0; i < _birdSum; i ++ ) {
				initBird(i);
			}
			
			//addEventListener(Event.ENTER_FRAME, enterFrameHandler);
		}
		
		private function initBird(value:int):void {
			
			var _birdClass:Class = ApplicationDomain.currentDomain.getDefinition("BirdMovie") as Class;
			var _birdMc:MovieClip = new _birdClass() as MovieClip;
			_birdMc.x = Math.random() * 100 - 50;
			_birdMc.y = Math.random() * 100 -50;
			addChild(_birdMc);
			_birdArr.push(_birdMc);
			
			_vXarr[value] = -Math.random();
			_vYarr[value] = Math.random() * 4 - 2;
			
			_preTimeArr[value] = getTimer();
			_changeSpeedArr[value] = Math.round(Math.random()*5+5)*1000;////间隔多少毫秒换所有的速度
			
		}
		
		private function enterFrameHandler(event:Event):void {
			
			for (var i:int = 0; i < _birdSum; i ++ ) {
				autoFly(_birdArr[i], i);
			}
		}
		public function render():void {
			
			for (var i:int = 0; i < _birdSum; i ++ ) {
				autoFly(_birdArr[i], i);
			}
		}
		
		public function rotationBird(value:Number):void {
			
			for (var i:int = 0; i < _birdSum; i ++ ) {
				(_birdArr[i] as MovieClip).rotation = value;
			}
		}
		
		private function autoFly(valueMc:MovieClip, valueNum:int):void {
			
			if (getTimer() - _preTimeArr[valueNum] > _changeSpeedArr[valueNum]) {
				
				_preTimeArr[valueNum] = getTimer();
				_vXarr[valueNum] = -Math.random();
				_vYarr[valueNum] = Math.random() * 4 - 2;
				_changeSpeedArr[valueNum] = Math.round(Math.random()*5+5)*1000;////间隔多少毫秒换所有的速度
			}
			
			valueMc.x += _vXarr[valueNum];
			valueMc.y += _vYarr[valueNum];
			
			if (valueMc.x <= _life || valueMc.x >= _right) {
				_vXarr[valueNum] *= -1;
			}
			
			if (valueMc.y <= _top || valueMc.y >= _bottom) {
				_vYarr[valueNum] *= -1;
			}
		}
	}//end Birds

}