///////////////////////////////////////////////////////////
//  ElementSound.as
//  Macromedia ActionScript Implementation of the Class ElementSound
//  Generated by Enterprise Architect
//  Created on:      22-十一月-2011 14:15:21
//  Original author: LuXianli
///////////////////////////////////////////////////////////

package com.raytoon.cannonfodder.puremvc.view.ui.soundLayer
{
	import com.raytoon.cannonfodder.puremvc.view.ui.UIMain;
	import flash.events.Event;
	import flash.media.Sound;
	import flash.media.SoundChannel;
	import flash.media.SoundTransform;
	import flash.system.ApplicationDomain;
	/**
	 * @author LuXianli
	 * @version 1.0
	 * @created 22-十一月-2011 14:15:21
	 */
	public class ElementSound
	{		
		private var _id:int = 0;
		public function set id(value:int):void {
			_id = value;
		}
		public function get id():int {
			return _id;
		}
		
		private var _sound:Sound;
		private var _soundChannel:SoundChannel;
		private var _soundPosition:Number = 0;
		public function ElementSound(soundName:String,soundVol:Number = 0.6,playSum:int = 0){
			
			var _soundClass:Class = ApplicationDomain.currentDomain.getDefinition(soundName) as Class;
			_sound = new _soundClass() as Sound;
			_soundChannel = _sound.play(0,playSum);
			if (_soundChannel) {
				
				_soundChannel.soundTransform = new SoundTransform(soundVol);
			}else {
				(UIMain.getInstance(SoundLayer.NAME) as SoundLayer).clearSound(this);
				return;
			}
			_soundChannel.addEventListener(Event.SOUND_COMPLETE, soundPlayComplete);
			_soundClass = null;
		}
		
		public function changeVol(vol:Number = 1):void {
			
			if (_soundChannel)
				_soundChannel.soundTransform.volume = vol;
		}
		
		private function soundPlayComplete(event:Event):void {
			
			if(_soundChannel)
				_soundChannel.removeEventListener(Event.SOUND_COMPLETE, soundPlayComplete);
			_sound = null;
			_soundChannel = null;
			(UIMain.getInstance(SoundLayer.NAME) as SoundLayer).clearSound(this);
		}
		
		public function pasueAndStart(flag:Boolean = true):void {
			
			if (flag) {
				if (_sound) {
					
					_soundChannel = _sound.play(_soundPosition);
					_soundChannel.addEventListener(Event.SOUND_COMPLETE, soundPlayComplete);
				}
			}else {
				if (_soundChannel) {
					_soundChannel.removeEventListener(Event.SOUND_COMPLETE, soundPlayComplete);
					_soundPosition = _soundChannel.position;
					_soundChannel.stop();
					_soundChannel = null;
				}else {
					_soundPosition = 0;
				}
				
			}
		}
		
		public function clear():void {
			
			if (_soundChannel) {
				
				_soundChannel.stop();
				_soundChannel.removeEventListener(Event.SOUND_COMPLETE, soundPlayComplete);
				_soundChannel = null;
			}
			
			if(_sound){
				
				_sound = null;
			}
		}
	}//end ElementSound

}