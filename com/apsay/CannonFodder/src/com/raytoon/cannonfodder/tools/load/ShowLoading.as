///////////////////////////////////////////////////////////
//  ShowLoading.as
//  Macromedia ActionScript Implementation of the Class ShowLoading
//  Generated by Enterprise Architect
//  Created on:      09-六月-2011 11:38:53
//  Original author: LuXianli
///////////////////////////////////////////////////////////

package com.raytoon.cannonfodder.tools.load
{
	import flash.display.MovieClip;
	import flash.display.Shape;
	import flash.display.Sprite;
	import flash.events.ProgressEvent;
	import flash.text.TextField;
	import flash.text.TextFormat;
	/**
	 * @author LuXianli
	 * @version 1.0
	 * @created 09-六月-2011 11:38:53
	 */
	public class ShowLoading extends Sprite
	{
		private var totalSize:Number = 0;
		private var currentSize:Number = 0;
		public function ShowLoading(){
			
		}
		
		public function showLoad(libXmlList:XMLList):void{
			
			totalSize = 0;
			for each(var libSize:* in libXmlList[0].libUrl) {
				
				totalSize += Number(libSize.@size);
			}
			
			showLogo();
		}
		
		private var cfLoad:CannonFodderLoading;
		private var _progressTxt:TextField;
		private var _progressTxtFormat:TextFormat;
		private function showLogo():void {
			
			cfLoad = new CannonFodderLoading();
			addChild(cfLoad);
			(cfLoad["ProgressBar"] as MovieClip).gotoAndStop(1);
			(cfLoad["ProgressLogo"] as MovieClip).addFrameScript((cfLoad["ProgressLogo"] as MovieClip).totalFrames - 1, function():void { (cfLoad["ProgressLogo"] as MovieClip).stop(); } );
			_progressTxtFormat = new TextFormat();
			_progressTxtFormat.align = "center";
			_progressTxtFormat.color = 0xFFFFFF;
//			_progressTxtFormat.font = "YaHei";
			_progressTxtFormat.size = 20;
			_progressTxt = new TextField();
			addChild(_progressTxt);
			_progressTxt.x = 335;
			_progressTxt.y = 560;
			_progressTxt.width = 70;
			_progressTxt.height = 25;
			_progressTxt.text = "00%";
			_progressTxt.selectable = false;
			_progressTxt.setTextFormat(_progressTxtFormat);
		}
		
		/**
		 * 控制加载进度条长度
		 * @param	event  加载进行中事件
		 */
		public function progressHandler(event:ProgressEvent):void {
			
			var crentInt:int = (currentSize + event.bytesLoaded) / totalSize * 100;
			if (cfLoad) {
				
				(cfLoad["ProgressBar"] as MovieClip).gotoAndStop(crentInt);
			}
			if (_progressTxt) {
				
				_progressTxt.text = String(crentInt) + "%";
				_progressTxt.setTextFormat(_progressTxtFormat);
			}
			if (event.bytesLoaded == event.bytesTotal) 
				currentSize += event.bytesTotal;
			
		}
		
		public function clear():void {
			
			removeChild(_progressTxt);
			_progressTxt = null;
			_progressTxtFormat = null;
			removeChild(cfLoad);
			cfLoad = null;
			currentSize = 0;
		}
	}//end ShowLoading

}